<!DOCTYPE html>
<html>
  <head>
    <title>Retail Promo Map</title>
    <meta charset="utf-8">
    <style>
      html, body, #map {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAC6xPeBpqBt8XklcVA7OJouEGVATJhZQA"></script>
    <script>
      async function initMap() {
       const response = await fetch('https://script.google.com/macros/s/AKfycbx_Gbo2ZYkSvzEEaBCib__x97LTCaPy4jTnRZbvGL93JBuSBOxnnU0gutCUrmUwPg/exec');
        const data = await response.json();
        const colors = {};
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center: { lat: parseFloat(data[0].Latitude), lng: parseFloat(data[0].Longitude) },
        });

        data.forEach(point => {
          const lat = parseFloat(point.Latitude);
          const lng = parseFloat(point.Longitude);
          const name = point.Name || point.Code || "Без названия";
          const supervisor = point.Supervisor || "Без супервайзера";

          if (!colors[supervisor]) {
            colors[supervisor] = getRandomColor();
          }

          new google.maps.Marker({
            position: { lat, lng },
            map,
            title: name,
            icon: {
              path: google.maps.SymbolPath.CIRCLE,
              scale: 8,
              fillColor: colors[supervisor],
              fillOpacity: 1,
              strokeColor: "#000",
              strokeWeight: 1,
            }
          });
        });
      }

      function getRandomColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }

      window.onload = initMap;
    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
